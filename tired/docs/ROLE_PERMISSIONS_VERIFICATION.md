# 角色權限驗證文件

## 角色層級架構

### 1. 系統角色（TenantMembership.Role）
- **owner** (擁有者): 最高權限，可管理所有功能和成員
- **admin** (管理員): 可管理大部分功能和成員
- **manager** (經理/教師): 可管理特定功能（如點名、打卡）
- **member** (成員/學生/員工): 基本用戶，可使用大部分功能
- **guest** (訪客): 受限訪問，只能查看部分內容

### 2. 功能角色（UserRole）
- **admin**: 系統管理員
- **teacher/manager**: 教師/主管
- **student/employee**: 學生/員工

## 權限矩陣

| 功能 | Owner | Admin | Manager | Member | Guest |
|------|-------|-------|---------|--------|-------|
| 查看首頁 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 查看動態 | ✅ | ✅ | ✅ | ✅ | ❌ |
| 發布動態 | ✅ | ✅ | ✅ | ✅ | ❌ |
| 管理好友 | ✅ | ✅ | ✅ | ✅ | ❌ |
| 發送訊息 | ✅ | ✅ | ✅ | ✅ | ❌ |
| 點名管理 | ✅ | ✅ | ✅ | ❌ | ❌ |
| 點名簽到 | ✅ | ✅ | ✅ | ✅ | ❌ |
| 打卡管理 | ✅ | ✅ | ✅ | ❌ | ❌ |
| 打卡記錄 | ✅ | ✅ | ✅ | ✅ | ❌ |
| 發布公告 | ✅ | ✅ | ✅ | ❌ | ❌ |
| 查看公告 | ✅ | ✅ | ✅ | ✅ | ✅ |
| ESG 管理 | ✅ | ✅ | ✅ | ❌ | ❌ |
| 查看 ESG | ✅ | ✅ | ✅ | ✅ | ❌ |
| 管理成員 | ✅ | ✅ | ❌ | ❌ | ❌ |
| 刪除他人內容 | ✅ | ✅ | ❌ | ❌ | ❌ |

## 租戶類型特定權限

### 學校 (School)
- **重點功能**: 點名、公告、作業
- **管理角色**: owner, admin → 教師權限
- **成員角色**: member → 學生權限
- **典型能力包**: Campus Pack

### 企業 (Company)  
- **重點功能**: 打卡、ESG、公告
- **管理角色**: owner, admin → 主管權限
- **成員角色**: member → 員工權限
- **典型能力包**: Company Pack

### 社群 (Community)
- **重點功能**: 活動、投票、聊天
- **管理角色**: owner, admin → 幹部權限
- **成員角色**: member → 成員權限
- **典型能力包**: Community Pack

### SME-ESG
- **重點功能**: 碳排管理、報告
- **管理角色**: owner, admin → ESG 管理員
- **成員角色**: member → 參與者
- **典型能力包**: ESG Pack

## 當前實現檢查

### ✅ 已正確實現的邏輯

1. **角色映射** (AttendanceView.swift)
   - owner, admin → admin 角色
   - manager → teacher/manager 角色（根據租戶類型）
   - member → student/employee 角色
   
2. **訪問控制** (TenantMembership.hasAccess)
   - 根據能力包檢查模組訪問權限
   - session.canAccess() 檢查用戶是否可以訪問特定模組

3. **視圖層級分離**
   - 管理員視圖 vs 成員視圖
   - 根據 userRole.isManager 顯示不同內容

### ⚠️ 需要加強的地方

1. **社交功能權限檢查**
   - FeedView、ChatView、FriendsView 目前沒有角色檢查
   - 所有用戶都可以使用社交功能
   - 建議：guest 角色應該被限制

2. **內容刪除權限**
   - 沒有實現 `canDelete` 檢查
   - 用戶應該只能刪除自己的內容
   - 管理員可以刪除他人內容

3. **成員管理功能**
   - 沒有實際的成員管理界面
   - 需要為 owner/admin 添加成員管理功能

## 建議改進

1. 在社交視圖中添加權限檢查
2. 實現內容所有權檢查
3. 添加管理員成員管理界面
4. 加強 guest 角色的限制

